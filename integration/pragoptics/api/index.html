<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Primary Meta -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PragOptics™ Dev Console</title>
<meta name="description" content="PragOptics Developer Console — authenticate, explore APIs, and integrate with the PragOptics platform.">

<!-- Canonical -->
<link rel="canonical" href="https://fortiviewholdings.com/integration/pragoptics/api">

<!-- Open Graph -->
<meta property="og:title" content="PragOptics™ Dev Console">
<meta property="og:description" content="Authenticate, explore APIs, and integrate with the PragOptics platform.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://fortiviewholdings.com/integration/pragoptics/api">
<meta property="og:image" content="https://fortiviewholdings.com/images/social-preview.png">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="PragOptics™ Dev Console">
<meta name="twitter:description" content="Authenticate, explore APIs, and integrate with the PragOptics platform.">
<meta name="twitter:image" content="https://fortiviewholdings.com/images/social-preview.png">


  <!-- Icons -->
  <link rel="icon" type="image/x-icon" href="https://fortiviewholdings.com/images/favicon.ico" sizes="48x48">
  <link rel="icon" type="image/png" href="https://fortiviewholdings.com/images/favicon.png" sizes="192x192">
  <link rel="apple-touch-icon" href="https://fortiviewholdings.com/images/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.webmanifest">

<!-- Theme -->
<meta name="theme-color" content="#000000">

  <style>
    :root{
      --bg-deep:#000000 !important;
      --grad:linear-gradient(135deg,#121b2d 0%,#060e1e 40%,#0f1824 100%);
      --glass:#0000006e;
      --glass-2:#11101012;
      --border:#ffffff1a;
      --ink:#e7ecff;
      --muted:#c6d0f0a6;
      --brand:#1ca490da;
      --brand-600:#21bca5;
      --aura:0 4px 8px rgba(17, 76, 67, 0.678);
      --radius:16px;
      --radius-sm:12px;
      --maxw:1200px;
    }

    *{box-sizing:border-box}
    html,body{
      margin:0; padding:0;
      font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg-deep); color:var(--ink);
    }

    a{color:inherit;text-decoration:none}

    /* ============================
       STARFIELD + BACKGROUND LAYERS
       ============================ */

html, body {
  background: transparent !important;   /* REQUIRED for Delgado-style starfield */
}

/* STARFIELD ABOVE GRADIENT */
#bg-stars {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1;        /* stars ABOVE gradient */
  pointer-events: none;
  opacity: 0;
  animation: fvStarFade 3.7s ease forwards;
}

/* GRADIENT BELOW STARS */
.bg {
  position: fixed;
  inset: 0;
  z-index: -2;        /* gradient BELOW stars */
  background: var(--grad);
  filter: blur(6px) brightness(.9) saturate(1.05);
  transform: scale(1.03);
}

.bg::after {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top left, var(--bg-deep)), transparent 55%);
}

@keyframes fvStarFade {
  0% { opacity: 0; }
  60% { opacity: 0.2; }
  100% { opacity: 0.5; }
}
    /* ============================
       HEADER
       ============================ */

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(140%) blur(10px);
      background:var(--glass);
      border-bottom:1px solid var(--border);
    }

    .nav{
      max-width:var(--maxw); margin:0 auto; padding:14px 20px;
      display:flex; align-items:center; gap:12px;
      justify-content:space-between;
    }

    .logo{
      width:34px; height:34px; border-radius:10px;
      background-image:url('https://fortiviewholdings.com/images/Logo.png');
      background-size:cover; background-position:center;
      box-shadow:0 0 0 2px rgba(92,140,69,.25), 0 10px 20px rgba(92,140,69,.18);
    }

    /* ============================
       MENU DROPDOWN
       ============================ */

    .dev-nav ul {
      list-style:none;
      margin:0;
      padding:0;
    }

    .dropdown {
      position:relative;
    }

    .dropdown-toggle {
      background:none;
      border:1px solid transparent;
      color:var(--brand-600);
      font-size:0.95rem;
      padding:8px 12px;
      border-radius:12px;
      cursor:pointer;
      transition:0.2s ease;
    }

    .dropdown-toggle:hover {
      background:rgba(33,188,165,0.12);
      border:1px solid var(--brand-600);
      color:var(--brand-600);
    }

    .dropdown-menu {
      display:none;
      position:absolute;
      top:110%;
      right:0;
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:var(--radius-sm);
      box-shadow:var(--aura);
      min-width:220px;
      padding:8px 0;
      z-index:100;
      backdrop-filter:blur(14px) saturate(160%);
    }

    .dropdown-menu li span.menu-section {
      display:block;
      padding:8px 16px 4px;
      font-size:0.8rem;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:var(--brand-600);
      font-weight:600;
      opacity:0.9;
    }

    .dropdown-menu li a {
      display:block;
      padding:8px 16px;
      color:var(--ink);
      font-size:0.9rem;
      font-weight:500;
      transition:0.2s ease;
    }

    .dropdown-menu li a:hover {
      background:rgba(33,188,165,0.12);
      color:var(--brand-600);
    }

    .dropdown.open .dropdown-menu {
      display:block;
    }

    /* ============================
       MAIN LAYOUT
       ============================ */

    .page{
      max-width:var(--maxw);
      margin:32px auto;
      padding:0 20px 40px;
    }

    .glass{
      background:var(--glass);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--aura);
    }

    .main{
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .glass.main {
  background: var(--glass-2);   /* lighter glass */
  backdrop-filter: blur(14px) saturate(160%);
}

    .login-panel{
      padding:14px;
      border-radius:var(--radius-sm);
      background:var(--glass-2);
      border:1px solid var(--border);
      font-size:0.9rem;
    }

    .viewer{
      flex:1;
      min-height:260px;
      padding:16px;
      background:var(--glass);
      border-radius:var(--radius-sm);
      border:1px solid var(--border);
      font-size:0.9rem;
      overflow:auto;
      color:var(--brand-600);
      backdrop-filter:blur(14px) saturate(160%);
    }

    pre{
      white-space:pre-wrap;
      word-break:break-word;
      margin:0;
    }

    /* ============================
       COPY BUTTON + TOAST
       ============================ */

    .copy-btn {
      margin-left:15px;
      padding:4px 10px;
      font-size:0.8rem;
      border-radius: 12px;
      border:1px solid var(--brand-600);
      background:var(--glass-2);
      color:var(--brand-600);
      cursor:pointer;
      transition:0.2s ease;
    }

    .copy-btn:hover {
      background:rgba(33,188,165,0.12);
      border-color:var(--brand-600);
      color:var(--brand-600);
      transform:translateY(-2px);
    }

    .toast {
      position:fixed;
      bottom:20px;
      right:20px;
      background:rgba(0,0,0,0.55);
      border:1px solid rgba(255,255,255,0.12);
      padding:10px 16px;
      border-radius:var(--radius-sm);
      color:var(--ink);
      backdrop-filter:blur(12px) saturate(160%);
      box-shadow:var(--aura);
      opacity:0;
      transform:translateY(10px);
      transition:opacity .3s ease, transform .3s ease;
      z-index:9999;
      font-size:0.9rem;
    }

    .toast.show {
      opacity:1;
      transform:translateY(0);
    }

    .global-darken {
  position: fixed;
  inset: 0;
  z-index: -0.5; /* above stars (-1), below UI (0+) */
  background: rgba(0, 0, 0, 0.25); /* adjust darkness here */
  pointer-events: none;
}
  </style>
</head>

<body>

<!-- STARFIELD + BACKGROUND -->
<div class="global-darken"></div>
<canvas id="bg-stars"></canvas>
<div class="bg"></div>

<header>
  <div class="nav">
    <div class="brand" style="display:flex;align-items:center;gap:10px;">
      <div class="logo"></div>
      <div>
        <div style="font-weight:600;">PragOptics™ <span style="color:var(--brand-600);">Dev Console</span></div>
        <div style="font-size:0.85rem; color:var(--muted);">Developer Tools & API Explorer</div>
      </div>
    </div>

    <nav class="dev-nav">
      <ul>
        <li class="dropdown">
          <button class="dropdown-toggle">Services ▾</button>
          <ul class="dropdown-menu">
            <li><span class="menu-section">Authentication</span></li>
            <li><a href="#" onclick="event.preventDefault(); startPragOpticsLogin();">Start Login</a></li>
            <li><a href="#" onclick="event.preventDefault(); callPragOpticsAuth();">Call /auth</a></li>

            <li><span class="menu-section">API Endpoints</span></li>
            <li><a href="#" onclick="event.preventDefault(); callPragOpticsAuth();">/auth</a></li>
            <li><a href="#" onclick="event.preventDefault(); callPragOpticsHealth();">/health</a></li>

            <li><span class="menu-section">SDKs</span></li>
            <li><a href="#" onclick="event.preventDefault();">JavaScript SDK</a></li>

            <li><span class="menu-section">Account</span></li>
            <li><a href="#" onclick="event.preventDefault();">Profile</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>

<main class="page">
  <section class="glass main">

    <div>
      <h2 style="margin:0 0 6px; color:var(--brand-600);">API <span style="color:var(--muted);">Viewer</span></h2>
      <p style="margin:0; color:var(--muted); font-size:0.85rem;">
        Use the Services menu to authenticate and call PragOptics APIs. Responses appear below.
      </p>
    </div>

    <!-- ⭐ NEW LOGIN PANEL (PKCE VERSION) -->
    <div id="po-login-panel" class="login-panel" style="display:none;">
      <strong style="display:block; margin-bottom:6px;">PragOptics Login</strong>

      <div id="po-login-status" style="color:var(--muted); margin-top:4px;">
        <!-- Filled dynamically -->
      </div>

      <button id="po-login-cta" class="copy-btn" style="margin-top:10px; display:none;">
        Continue to Login
      </button>
    </div>

    <!-- Viewer -->
    <div class="viewer">
      <pre id="po-output">{ "hint": "Call /auth or start login to see responses here." }</pre>
    </div>

  </section>
</main>

<script>
/* ============================
   GLOBAL STATE
   ============================ */
let pragopticsToken = null;
let pragopticsAuthorizeUrl = null;

/* ============================
   OUTPUT VIEWER
   ============================ */
function setOutput(obj) {
  document.getElementById("po-output").textContent =
    JSON.stringify(obj, null, 2);
}

/* ============================
   START LOGIN (Triggered from dropdown)
   ============================ */
async function startPragOpticsLogin() {
  try {
    const res = await fetch("https://api.pragoptics.com/api/v1/auth/login");
    const data = await res.json();

    // Show login panel
    const panel = document.getElementById("po-login-panel");
    panel.style.display = "block";

    // Update status
    document.getElementById("po-login-status").innerText =
      "Ready to authenticate. Click the button below.";

    // Store authorize URL
    pragopticsAuthorizeUrl = data.authorizeUrl;

    // Show CTA button
    const cta = document.getElementById("po-login-cta");
    cta.style.display = "inline-block";

    // Open CIAM in a new tab
    cta.onclick = () => {
      window.open(pragopticsAuthorizeUrl, "_blank");
    };

    // Show response in viewer
    setOutput({
      endpoint: "/auth/login",
      flow: data.flow,
      authorizeUrl: data.authorizeUrl,
      state: data.state
    });

  } catch (err) {
    setOutput({
      endpoint: "/auth/login",
      error: "Failed to start login",
      detail: String(err)
    });
  }
}

/* ============================
   HANDLE CALLBACK
   ============================ */
async function handlePragOpticsCallback() {
  const params = new URLSearchParams(window.location.search);
  const code = params.get("code");
  const state = params.get("state");
  const error = params.get("error");
  const error_description = params.get("error_description");

  if (!code && !error) return; // Not a callback

  // Show login panel
  const panel = document.getElementById("po-login-panel");
  panel.style.display = "block";

  const status = document.getElementById("po-login-status");

  if (error) {
    status.innerText = `Login failed: ${error_description}`;
    setOutput({ endpoint: "/auth/callback", error, error_description });
    return;
  }

  status.innerText = "Completing authentication…";

  const res = await fetch(
    "https://api.pragoptics.com/api/v1/auth/callback" +
      window.location.search
  );

  const data = await res.json();

  setOutput({
    endpoint: "/auth/callback",
    response: data
  });

  pragopticsToken = data.tokens?.access_token || null;

  status.innerText = "Authenticated successfully.";
}

window.addEventListener("load", handlePragOpticsCallback);

/* ============================
   CALL /auth
   ============================ */
async function callPragOpticsAuth() {
  try {
    const res = await fetch("https://api.pragoptics.com/api/v1/auth", {
      headers: pragopticsToken
        ? { Authorization: `Bearer ${pragopticsToken}` }
        : {}
    });

    const data = await res.json();
    setOutput({ endpoint: "/auth", response: data });
  } catch (err) {
    setOutput({ endpoint: "/auth", error: String(err) });
  }
}

/* ============================
   CALL /health
   ============================ */
async function callPragOpticsHealth() {
  try {
    const res = await fetch("https://api.pragoptics.com/api/v1/health", {
      headers: pragopticsToken
        ? { Authorization: `Bearer ${pragopticsToken}` }
        : {}
    });

    const data = await res.json();
    setOutput({ endpoint: "/health", response: data });
  } catch (err) {
    setOutput({ endpoint: "/health", error: String(err) });
  }
}

/* ============================
   DROPDOWN MENU
   ============================ */
document.addEventListener("click", (e) => {
  const isToggle = e.target.matches(".dropdown-toggle");
  const dropdowns = document.querySelectorAll(".dropdown");

  dropdowns.forEach((d) => {
    if (d.contains(e.target) && isToggle) {
      d.classList.toggle("open");
    } else {
      d.classList.remove("open");
    }
  });
});

/* ============================
   STARFIELD (unchanged)
   ============================ */
window.addEventListener("load", () => {
  const canvas = document.getElementById("bg-stars");
  const ctx = canvas.getContext("2d");

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener("resize", resize);

  const starCount = 160;
  const stars = [];

  for (let i = 0; i < starCount; i++) {
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 1.2 + 0.4,
      alpha: Math.random(),
      delta: Math.random() * 0.015 + 0.005
    });
  }

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let s of stars) {
      s.alpha += s.delta;
      if (s.alpha <= 0 || s.alpha >= 1) s.delta = -s.delta;

      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
      ctx.fill();
    }

    requestAnimationFrame(animate);
  }

  animate();
});
</script>

</body>
</html>
