<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fortiview Holdings ‚Äî PragOptics‚Ñ¢ System Integration</title>
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="dark light" />
  <meta property="og:image" content="https://fortiviewholdings.com/images/social-preview.png">
<style>
  :root{
    --bg-deep:#0b1022;
    --bg-accent:#0b1c3d;
    --glass:#101a33cc;
    --glass-2:#0f1933cc;
    --border:#ffffff1a;
    --ink:#e7ecff;
    --muted:#c6d0f0a6;
    --brand:#5c8c45;
    --brand-600:#4d7a39;
    --aura:0 10px 24px rgba(92,140,69,.35);
    --radius:16px;
    --radius-sm:12px;
    --maxw:1200px;
    --grad:linear-gradient(135deg,#182a52 0%,#0b1c3d 40%,#1d3557 100%);
  }

  *{box-sizing:border-box}
  html,body{
    margin:0; padding:0;
    font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:var(--bg-deep); color:var(--ink);
    scroll-behavior:smooth;
    -webkit-text-size-adjust:100%;
  }
  a{color:inherit;text-decoration:none}
  img{display:block;max-width:100%}

  /* Screen-reader only helper */
  .sr-only {
    position:absolute !important;
    width:1px; height:1px;
    padding:0; margin:-1px;
    overflow:hidden; clip:rect(0,0,0,0);
    white-space:nowrap; border:0;
  }

  /* ===== Global full-screen shimmer overlay (hidden by default) ===== */
  .loader-shimmer{
    position:fixed; inset:0; z-index:9999;
    pointer-events:auto; /* block clicks while loading */
    opacity:0; visibility:hidden;
    transition:opacity 160ms ease, visibility 0s linear 160ms;

    /* subtle dim + shimmer sweep (keeps content visible underneath) */
    background-color:rgba(0,0,0,0.06);
    background-image:linear-gradient(
      90deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,0.18) 40%,
      rgba(255,255,255,0.45) 50%,
      rgba(255,255,255,0.18) 60%,
      rgba(255,255,255,0) 100%
    );
    background-size:200% 100%;
    will-change:opacity, background-position;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  html.is-loading .loader-shimmer{
    opacity:1; visibility:visible;
    transition:opacity 160ms ease;
    animation:shimmer-sweep 1.25s linear infinite;
  }
  @keyframes shimmer-sweep{
    0%{ background-position:-200% 0; }
    100%{ background-position:200% 0; }
  }
  /* Freeze page scroll (optional) */
  html.is-loading{ overflow:hidden; }
  /* Respect reduced-motion */
  @media (prefers-reduced-motion: reduce){
    html.is-loading .loader-shimmer{ animation:none; }
  }

  /* Keep iOS from zooming inputs on focus */
  input, select, textarea { font-size:16px; }

  .bg{
    position:fixed; inset:0; z-index:-2;
    background:
      radial-gradient(1100px 700px at 12% -10%, #5ac8fa22, transparent 60%),
      radial-gradient(900px 600px at 110% 10%, rgba(92,140,69,.20), transparent 55%),
      var(--grad);
    filter:blur(6px) brightness(.9) saturate(1.05);
    transform:scale(1.03);
  }
  .bg::after{
    content:""; position:absolute; inset:0;
    background:
      radial-gradient(900px 500px at 50% -10%, transparent, #000814bb 70%),
      linear-gradient(to bottom, #00000066, transparent 35%, #00000077 100%);
  }
  #bg-stars{
    position:fixed; inset:0; width:100vw; height:100vh; z-index:-1; pointer-events:none;
  }

  header{
    position:sticky; top:0; z-index:50;
    backdrop-filter:saturate(140%) blur(10px);
    background:#0b1224cc;
    border-bottom:1px solid var(--border);
  }
  .nav{
    max-width:var(--maxw); margin:0 auto; padding:14px 20px;
    display:flex; align-items:center; justify-content:space-between; gap:16px;
  }
  .brand{display:flex; align-items:center; gap:10px; letter-spacing:.4px}
  .logo{
    width:34px; height:34px; border-radius:10px;
    background-image:url('https://fortiviewholdings.com/images/Logo.png');
    background-size:cover; background-position:center;
    box-shadow:0 0 0 2px rgba(92,140,69,.25), 0 10px 20px rgba(92,140,69,.18);
  }
  .brand strong{font-weight:800}
  nav ul{display:flex; gap:14px; list-style:none; align-items:center; margin:0; padding:0}
  .link{
    padding:9px 14px; border-radius:999px; color:var(--muted);
    border:1px solid transparent; transition:.2s ease;
  }
  .link:hover{color:#fff; border-color:#ffffff22; background:#ffffff12}
  .cta{
    background:linear-gradient(180deg, var(--brand), var(--brand-600));
    color:#0c120a; font-weight:800; letter-spacing:.2px;
    padding:10px 16px; border-radius:999px; box-shadow:var(--aura);
  }
  .cta:hover{filter:brightness(.95)}

  .cta-btn{
    display:inline-block;
    background:#2a354d; /* toned-down dark button */
    color:#e7ecff; font-weight:600;
    padding:10px 18px; border-radius:999px;
    border:1px solid var(--border);
    transition:all .2s ease; cursor:pointer;
  }
  .cta-btn:hover{ background:#3a4661; transform:translateY(-2px); }

  /* Success lock state for the CTA button */
  .cta-btn.is-selected{
    background:linear-gradient(180deg, var(--brand), var(--brand-600));
    color:#0c120a;
    border-color:#2f4d24;
    box-shadow:0 0 0 3px rgba(92,140,69,.28);
    cursor:default;
  }
  .cta-btn.is-selected:disabled{ opacity:1; }
  .cta-btn.is-selected::after{
    content:" ‚úì";
    font-weight:700;
  }

  .section{max-width:var(--maxw); margin:36px auto; padding:0 20px}
  .glass{
    background:var(--glass); border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--aura); padding:32px;
  }

  .dropdown{ position:relative; }
  .dropdown-toggle{
    background:none; border:none; cursor:pointer; font:inherit;
    color:var(--muted); padding:9px 14px; border-radius:999px;
  }
  .dropdown-toggle:hover{ color:#fff; background:#ffffff12; border:1px solid #ffffff22; }
  .dropdown-menu{
    display:none; position:absolute; top:110%; left:0;
    background:var(--glass); border:1px solid var(--border);
    border-radius:var(--radius-sm); box-shadow:var(--aura);
    list-style:none; margin:0; padding:8px 0; min-width:240px; z-index:100;
  }
  .dropdown-menu li a{
    display:block; padding:10px 16px; color:var(--ink);
  }
  .dropdown-menu li a:hover{ background:#ffffff12; color:#fff; }

  .option-card{
    flex:1 1 200px;
    background:var(--glass-2);
    border:1px solid var(--border);
    border-radius:var(--radius-sm);
    padding:16px; cursor:pointer; transition:all .2s ease;
  }
  .option-card:hover{ background:#ffffff12; border-color:var(--brand); }
  .option-card.selected{
    background:#1a233a; border-color:var(--brand);
    box-shadow:0 0 0 2px rgba(92,140,69,.35);
  }

  .table-wrapper{ width:100%; overflow-x:auto; -webkit-overflow-scrolling:touch; }
  .table-wrapper table{
    width:100%; border-collapse:collapse; min-width:500px;
    margin-top:1rem; font-size:.95rem;
  }
  th, td{ padding:12px; border-bottom:1px solid var(--border); }
  th{ background:var(--bg-accent); color:#fff; }
  td:first-child{ text-align:left; }

  .check{ color:var(--brand); font-weight:700; text-align:center; }
  .cross{ color:#f44336; font-weight:700; text-align:center; }

  table td:nth-child(2),
  table td:nth-child(3),
  table td:nth-child(4),
  table th:nth-child(2),
  table th:nth-child(3),
  table th:nth-child(4){ text-align:center; }

  #ctaBox{ position:relative; }

  /* Hide the old local overlay if it still exists in markup */
  #loadingOverlay{ display:none !important; }

  /* Utility to hide containers after success (JS will toggle) */
  [hidden]{ display:none !important; }

  footer{ margin:50px 0 30px 0; color:var(--muted); text-align:center; font-size:.9rem }

  @media (max-width: 640px){
    .nav{ flex-direction:column; align-items:stretch; }
    .brand{ justify-content:center; margin-bottom:8px; }
    nav ul{ flex-wrap:wrap; justify-content:center; gap:8px; }
    nav ul li{ flex:1 1 auto; display:flex; justify-content:center; }
    nav ul a{ width:100%; text-align:center; }
  }
</style>
</head>
<body>
  
  <!-- Shimmer Loader (full-screen, hidden by default; CSS in Step 2) -->
  <div id="page-loader" class="loader-shimmer" role="status" aria-live="polite" aria-hidden="true">
    <span class="sr-only">Loading‚Ä¶</span>
  </div>

  <div class="bg" aria-hidden="true"></div>
  <canvas id="bg-stars" aria-hidden="true"></canvas>

  <header>
    <div class="nav">
      <a class="brand" href="https://fortiviewholdings.com">
        <div class="logo" aria-hidden="true"></div>
        <strong>Fortiview</strong>
        <span style="color:var(--muted)">Holdings</span>
      </a>
      <nav aria-label="Primary">
        <ul>
          <li class="dropdown">
            <button class="link dropdown-toggle" onclick="toggleDropdown()">Services ‚ñæ</button>
            <ul id="servicesDropdown" class="dropdown-menu">
              <li><a href="/leadership">Leadership & Business Strategy</a></li>
              <li><a href="/operations">Project & Operations Management</a></li>
              <li><a href="/finance">Financial Coordination</a></li>
              <li><a href="/marketing">Marketing, Sales & Client Relations</a></li>
              <li><a href="/governance">Governance & Regulatory Support</a></li>
              <li><a href="/cx">Customer Experience Optimization</a></li>
              <li><a href="/partnerships">Networking & Partnerships</a></li>
              <li><a href="/integration/">PragOptics‚Ñ¢ System Integration</a></li>
              <li><a href="/youth">Youth Entrepreneur Education</a></li>
            </ul>
          </li>
          <li><a class="link" href="/integration/terms">Terms & Conditions</a></li>
          <li><a class="cta" href="mailto:support@fortiviewholdings.com?subject=Fortiview%20Inquiry">Work with us</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- PragOptics Section -->
  <section id="integration" class="section">
    <div class="glass">
      <h2 style="margin-top:0; color:var(--brand)">PragOptics‚Ñ¢ System Integration</h2>
            <p style="color:var(--muted); font-size:1.05rem; line-height:1.6;">
        PragOptics‚Ñ¢ is our framework for unifying your business systems into a single,
        transparent architecture. We connect your data, workflows, and customer touchpoints
        into dashboards that drive clarity and accountability.
      </p>
      <ul style="margin-top:16px; color:var(--ink); line-height:1.6;">
        <li>üîó Seamless integration of Microsoft 365, CRM, and POS systems</li>
        <li>üìä Unified dashboards for finance, operations, and customer experience</li>
        <li>‚ö° Automation pipelines (Power Automate, PowerShell, Python)</li>
        <li>üîí Identity-aware access control and compliance-ready logging</li>
        <li>üåê Scalable architecture designed for growth and partnerships</li>
      </ul>
<!-- CTA Button -->
<div style="margin-top:28px;">
  <button class="cta-btn" onclick="openCtaBox()">Select Your Package</button>
</div>

<!-- Hidden Container -->
<div id="ctaBox" class="glass" style="display:none; margin-top:20px; padding:20px;">
  <h3 style="margin-top:0; color:var(--brand)">Choose Your Tier</h3>
  <div id="tierOptions" style="display:flex; gap:16px; flex-wrap:wrap;">
    <div class="option-card" onclick="selectTier(this,'Email Essentials')">
      <strong>Email Essentials</strong>
      <p style="color:var(--muted); font-size:.9rem;">Branded email, SharePoint, backend support</p>
    </div>
    <div class="option-card" onclick="selectTier(this,'Productivity Suite')">
      <strong>Productivity Suite</strong>
      <p style="color:var(--muted); font-size:.9rem;">Everything in Essentials + Office apps, Teams, automation</p>
    </div>
  </div>

  <!-- Payment Terms -->
  <div id="planBox" style="display:none; margin-top:24px;">
    <h3 style="margin-top:0; color:var(--brand)">Choose Payment Plan</h3>
    <div id="planOptions" style="display:flex; gap:16px; flex-wrap:wrap;">
      <div class="option-card" onclick="selectPlan(this,'Monthly')"><strong>Monthly</strong></div>
      <div class="option-card" onclick="selectPlan(this,'Quarterly')"><strong>Quarterly</strong></div>
      <div class="option-card" onclick="selectPlan(this,'Annual')"><strong>Annual</strong></div>
    </div>
  </div>

  <!-- Confirmation -->
  <div id="summaryBox" style="display:none; margin-top:24px; color:var(--ink);">
    <h3 style="margin-top:0; color:var(--brand)">Your Selection</h3>
    <p id="summaryText"></p>
    <button id="submitBtn" class="cta-btn" style="margin-top:16px; display:none;" onclick="showContactForm()">
      Submit Request
    </button>
  </div>

<!-- Contact Form -->
<div id="contactForm" style="display:none; margin-top:24px;">
  <h3 style="margin-top:0; color:var(--brand)">Enter Your Contact Information</h3>
  <form onsubmit="handleFormSubmit(event)" autocomplete="on">
    <label>
      Name:<br>
      <input type="text" id="custName" name="name" autocomplete="name"
             required style="width:100%; padding:8px; margin:6px 0;">
    </label><br>

    <label>
      Business Name:<br>
      <input type="text" id="businessName" name="organization" autocomplete="organization"
             required style="width:100%; padding:8px; margin:6px 0;">
    </label><br>

    <label>
      Email:<br>
      <input type="email" id="custEmail" name="email" autocomplete="email"
             required style="width:100%; padding:8px; margin:6px 0;">
    </label><br>

    <label>
      Phone:<br>
      <input type="tel" id="custPhone" name="tel" autocomplete="tel"
             inputmode="numeric" maxlength="10"
             placeholder="Enter 10 digits"
             style="width:100%; padding:8px; margin:6px 0;"
             onblur="formatPhone(this)">
    </label><br>

    <label>
      State:<br>
      <select id="custState" name="address-level1" autocomplete="address-level1"
              required style="width:100%; padding:8px; margin:6px 0;">
        <option value="">Select a state</option>
        <option value="AL">Alabama</option>
        <option value="AK">Alaska</option>
        <option value="AZ">Arizona</option>
        <option value="AR">Arkansas</option>
        <option value="CA">California</option>
        <option value="CO">Colorado</option>
        <option value="CT">Connecticut</option>
        <option value="DE">Delaware</option>
        <option value="FL">Florida</option>
        <option value="GA">Georgia</option>
        <option value="HI">Hawaii</option>
        <option value="ID">Idaho</option>
        <option value="IL">Illinois</option>
        <option value="IN">Indiana</option>
        <option value="IA">Iowa</option>
        <option value="KS">Kansas</option>
        <option value="KY">Kentucky</option>
        <option value="LA">Louisiana</option>
        <option value="ME">Maine</option>
        <option value="MD">Maryland</option>
        <option value="MA">Massachusetts</option>
        <option value="MI">Michigan</option>
        <option value="MN">Minnesota</option>
        <option value="MS">Mississippi</option>
        <option value="MO">Missouri</option>
        <option value="MT">Montana</option>
        <option value="NE">Nebraska</option>
        <option value="NV">Nevada</option>
        <option value="NH">New Hampshire</option>
        <option value="NJ">New Jersey</option>
        <option value="NM">New Mexico</option>
        <option value="NY">New York</option>
        <option value="NC">North Carolina</option>
        <option value="ND">North Dakota</option>
        <option value="OH">Ohio</option>
        <option value="OK">Oklahoma</option>
        <option value="OR">Oregon</option>
        <option value="PA">Pennsylvania</option>
        <option value="RI">Rhode Island</option>
        <option value="SC">South Carolina</option>
        <option value="SD">South Dakota</option>
        <option value="TN">Tennessee</option>
        <option value="TX">Texas</option>
        <option value="UT">Utah</option>
        <option value="VT">Vermont</option>
        <option value="VA">Virginia</option>
        <option value="WA">Washington</option>
        <option value="WV">West Virginia</option>
        <option value="WI">Wisconsin</option>
        <option value="WY">Wyoming</option>
      </select>
    </label><br>

    <button type="submit" class="cta-btn" style="margin-top:12px;" data-act="integration">Finalize Request</button>
  </form>
</div>
</div>
  </section>

  <!-- Pricing Section -->
  <section id="pricing" class="section">
    <div class="glass">
      <h2 style="margin-top:0; color:var(--brand)">Strategic Service Packages</h2>
      <p style="color:var(--muted); margin-bottom:24px;">
        Transparent pricing with scalable options. Every package includes a dedicated tenant,
        domain integration, and Fortiview-managed security.
      </p>

      <h3>One-Time Setup Fee ‚Äî $1,500</h3>
      <ul>
        <li>Dedicated Microsoft 365 tenant creation</li>
        <li>Domain integration and DNS configuration</li>
        <li>Branded SharePoint environment</li>
        <li>Front-facing static website</li>
        <li>Identity and access control setup</li>
        <li>Initial user provisioning and license assignment</li>
        <li>Backend security enforcement and monitoring</li>
      </ul>

      <h3>Subscription Tiers (Per User)</h3>
      <div style="overflow-x:auto;">
        <table>
          <thead>
            <tr>
              <th>Service / Feature</th>
              <th>Email Essentials</th>
              <th>Productivity Suite</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Branded email under your domain</td><td class="check">‚úî</td><td class="check">‚úî</td></tr>
            <tr><td>Microsoft 365 license</td><td>Basic</td><td>Standard (Office apps)</td></tr>
            <tr><td>SharePoint access for document storage</td><td class="check">‚úî</td><td class="check">‚úî</td></tr>
            <tr><td>DNS management (SPF, DKIM, DMARC)</td><td class="check">‚úî</td><td class="check">‚úî</td></tr>
            <tr><td>Fortiview-managed updates & security</td><td class="check">‚úî</td><td class="check">‚úî</td></tr>
            <tr><td>Ongoing backend support</td><td class="check">‚úî</td><td class="check">‚úî</td></tr>
            <tr><td>Microsoft Teams collaboration</td><td class="cross">‚úò</td><td class="check">‚úî</td></tr>
            <tr><td>Microsoft Office apps (Word, Excel, Outlook, PowerPoint)</td><td class="cross">‚úò</td><td class="check">‚úî</td></tr>
            <tr><td>Advanced SharePoint features</td><td class="cross">‚úò</td><td class="check">‚úî</td></tr>
            <tr><td>Custom automation flows & app development</td><td class="cross">‚úò</td><td class="check">‚úî</td></tr>
          </tbody>
        </table>
      </div>
      
<h3 style="margin-top:32px; color:var(--brand)">Pricing (Per User)</h3>

<div class="table-wrapper">
  <table>
    <thead>
      <tr>
        <th>Tier</th>
        <th>Monthly</th>
        <th>Quarterly (5% off)</th>
        <th>Annual (10% off)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Email Essentials</td>
        <td>$10</td>
        <td>$28.50</td>
        <td>$108</td>
      </tr>
      <tr>
        <td>Productivity Suite</td>
        <td>$20</td>
        <td>$57</td>
        <td>$216</td>
      </tr>
    </tbody>
  </table>
</div>
  </section>

  <footer>
    <p>¬© 2025 Fortiview Holdings LLC ‚Äî Secure, scalable, and fully managed.</p>
  </footer>

<script>
// ===========================
// Dropdown handling
// ===========================
function toggleDropdown() {
  const menu = document.getElementById('servicesDropdown');
  menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
}
document.addEventListener('click', function(e) {
  const dropdown = document.querySelector('.dropdown');
  if (dropdown && !dropdown.contains(e.target)) {
    const menu = document.getElementById('servicesDropdown');
    if (menu) menu.style.display = 'none';
  }
});

// ===========================
// Global shimmer loader + viewport reset
// ===========================
function resetViewportScale(options = { allowPinchAfter: true }) {
  let meta = document.querySelector('meta[name="viewport"]');
  if (!meta) {
    meta = document.createElement('meta');
    meta.name = 'viewport';
    document.head.appendChild(meta);
  }

  // Nudge then snap back so browsers recalc zoom (esp. iOS Safari)
  const base = 'width=device-width';
  meta.content = base + ', initial-scale=1.0001';
  requestAnimationFrame(() => {
    meta.content =
      base + ', initial-scale=1.0' +
      (options.allowPinchAfter ? ', user-scalable=yes' : ', maximum-scale=1.0');
  });

  // Defocus any element that might have triggered zoom
  if (document.activeElement && typeof document.activeElement.blur === 'function') {
    document.activeElement.blur();
  }
  // Tiny scroll helps some browsers snap the visual viewport back
  setTimeout(() => { window.scrollTo(0, Math.max(0, window.pageYOffset || 0)); }, 0);
}

const htmlEl = document.documentElement;
const loaderEl = document.getElementById('page-loader');

function startLoading({ resetZoom = true } = {}) {
  if (resetZoom) resetViewportScale();
  htmlEl.classList.add('is-loading');
  if (loaderEl) loaderEl.setAttribute('aria-hidden', 'false');
}

function stopLoading() {
  htmlEl.classList.remove('is-loading');
  if (loaderEl) loaderEl.setAttribute('aria-hidden', 'true');
}

// Optional global access
window.pageLoader = { start: startLoading, stop: stopLoading, resetViewportScale };

// ===========================
// Tier/Plan selection
// ===========================
let selectedTier = null;
let selectedPlan = null;

function openCtaBox() {
  document.getElementById('ctaBox').style.display = 'block';
  // Optional: bring it into view
  try { document.getElementById('ctaBox').scrollIntoView({ behavior: 'smooth', block: 'start' }); } catch {}
}

function selectTier(el, tier) {
  document.querySelectorAll('#tierOptions .option-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  selectedTier = tier;
  document.getElementById('planBox').style.display = 'block';
  updateSummary();
}

function selectPlan(el, plan) {
  document.querySelectorAll('#planOptions .option-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  selectedPlan = plan.toLowerCase();
  updateSummary();
}

function updateSummary() {
  if (selectedTier && selectedPlan) {
    document.getElementById('summaryBox').style.display = 'block';
    document.getElementById('summaryText').textContent =
      `You selected: ${selectedTier} with ${selectedPlan} billing.`;
    document.getElementById('submitBtn').style.display = 'inline-block';
  }
}

function showContactForm() {
  document.getElementById('contactForm').style.display = 'block';
}

// ===========================
// Phone formatting
// ===========================
function formatPhone(input) {
  let digits = input.value.replace(/\D/g, '').substring(0, 10);
  if (digits.length === 10) {
    const area = digits.substring(0,3);
    const mid = digits.substring(3,6);
    const last = digits.substring(6);
    input.value = `+1 (${area}) ${mid}-${last}`;
    input.dataset.raw = digits;
  } else {
    input.value = digits;
    input.dataset.raw = digits;
  }
}

// ===========================
// Pricing configuration
// ===========================
const INITIAL_SETUP_FEE = 1500;

// Pricing matrix: per-user cost by tier and plan
const PRICING_MATRIX = {
  "Email Essentials": {
    monthly: 10,
    quarterly: 28.50,
    annual: 108
  },
  "Productivity Suite": {
    monthly: 20,
    quarterly: 57,
    annual: 216
  }
};

// ===========================
// Omnitok integration
// ===========================
const API = {
  issueOmniTok: 'https://default6eda43f3fbf04e2b9978b543d9dd31.e3.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/4be2293ea9ca4e418ac17059d7209cf1/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=vGhxzQ1mnf06FenEffQzPjo1iP_OLyKLH-yzAkPGUjo' // replace with endpoint
};

async function getOmniTok(act) {
  let sid = sessionStorage.getItem('sid');
  if (!sid) {
    sid = crypto.randomUUID();
    sessionStorage.setItem('sid', sid);
  }

  let body = (typeof act === 'string') ? { act, sid } : { sid, ...act };

  const res = await fetch(API.issueOmniTok, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });

  if (!res.ok) throw new Error(`Failed to get OmniTok config for ${body.act || act}`);
  const data = await res.json();
  return { ...data, sid };
}

// ===========================
// Form submission (uses global shimmer + viewport reset)
// ===========================
async function handleFormSubmit(e) {
  e.preventDefault();

  const btn = e.submitter;
  const act = btn?.dataset.act || 'integration';

  // Generate a jobId for this request
  const jobId = `IntReq-${crypto.randomUUID()}`;

  // Look up per-user price from the matrix
  const perUserPrice = PRICING_MATRIX[selectedTier]?.[selectedPlan] || 0;

  const customerData = {
    jobId,
    name: document.getElementById('custName').value,
    business: document.getElementById('businessName').value,
    email: document.getElementById('custEmail').value,
    phoneRaw: document.getElementById('custPhone').dataset.raw || "",
    phoneFormatted: document.getElementById('custPhone').value,
    state: document.getElementById('custState').value,
    tier: selectedTier,
    plan: selectedPlan,
    setupFee: Number(INITIAL_SETUP_FEE),
    perUserPrice: Number(perUserPrice)
  };

  // Lock UI
  btn.disabled = true;
  document.querySelectorAll('#ctaBox input, #ctaBox select, #ctaBox button')
    .forEach(el => el.disabled = true);

  // >>> Global shimmer ON + viewport reset
  startLoading({ resetZoom: true });

  try {
    // Phase 1: Omnitok preflight
    const omni = await getOmniTok(act);
    if (!omni.endpoint) throw new Error("Omnitok preflight did not return an endpoint");

    // Phase 2: Call the returned endpoint with customerData
    const response = await fetch(omni.endpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-auth-token': omni.authToken,
        'x-omnitok': omni.OmniTok,
        'x-sid': omni.sid,
        'x-act': omni.act
      },
      body: JSON.stringify(customerData)
    });

    if (!response.ok) throw new Error("Backend rejected request");
    const result = await response.json();

    console.log("Final flow result:", result);

    // Success: collapse the form and mark the main button green
    const ctaBox = document.getElementById('ctaBox');
    if (ctaBox) ctaBox.setAttribute('hidden', '');

    const selectBtn = document.querySelector('.cta-btn');
    if (selectBtn) {
      selectBtn.textContent = 'Package selected'; // " ‚úì" will auto-append via CSS ::after
      selectBtn.classList.add('is-selected');
      selectBtn.disabled = true;
    }

    alert(
      `‚úÖ Your request has been sent!\n\n` +
      `We've emailed a confirmation to: ${result.email || customerData.email}\n` +
      `If you don't see it, please check your spam folder and mark us as a trusted sender.\n\n` +
      `Tracking ID: ${jobId}`
    );

  } catch (err) {
    console.error("Submission error:", err);

    // Unlock inputs so they can try again
    btn.disabled = false;
    document.querySelectorAll('#ctaBox input, #ctaBox select, #ctaBox button')
      .forEach(el => el.disabled = false);

    alert(
      "‚ùå Your request did not go through.\n\n" +
      "Please try again in a moment. If the problem persists, contact support."
    );
  } finally {
    // >>> Global shimmer OFF
    stopLoading();
  }
}
</script>
</body>
</html>
